<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#302b63">
    <title>üé¨ Emoji Movie Guessing Game</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    
    <!-- Loading overlay for Vosk model -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Loading Speech Engine</h2>
            <p id="loading-status">Initializing Vosk...</p>
            <div class="loading-progress">
                <div id="loading-progress-bar" class="loading-progress-bar"></div>
            </div>
            <p class="loading-hint">This only happens once</p>
            
            <!-- Show Logs Button -->
            <button id="show-logs-btn" class="show-logs-btn">
                <span class="logs-btn-icon">üìã</span>
                <span>Show Logs</span>
                <span class="logs-btn-arrow">‚ñº</span>
            </button>
            
            <!-- Expandable Logs Panel -->
            <div id="logs-panel" class="logs-panel">
                <div class="logs-header">
                    <span>üîç Loading Details</span>
                    <button id="clear-logs-btn" class="clear-logs-btn">Clear</button>
                </div>
                <div id="logs-content" class="logs-content"></div>
            </div>
        </div>
    </div>
    
    <div class="game-container">
        <!-- Start Screen / Home Page -->
        <div id="start-screen" class="screen active">
            <button id="settings-btn" class="settings-icon-btn" aria-label="Settings">
                ‚öôÔ∏è
            </button>
            
            <div class="hero-section">
                <div class="logo-container">
                    <div class="logo-glow"></div>
                    <div class="logo">üé¨</div>
                </div>
                <h1>Emoji Movie Quiz</h1>
                <p class="tagline">Guess the movie from emojis using your voice!</p>
            </div>
            
            <div class="rules-card">
                <div class="rules-header">
                    <span>üìñ How to Play</span>
                </div>
                <div class="rules-list">
                    <div class="rule-item">
                        <span class="rule-number">1</span>
                        <span class="rule-text">Look at the emojis and think of the movie</span>
                    </div>
                    <div class="rule-item">
                        <span class="rule-number">2</span>
                        <span class="rule-text">When the mic turns on, say the movie name</span>
                    </div>
                    <div class="rule-item">
                        <span class="rule-number">3</span>
                        <span class="rule-text">Answer faster to earn bonus points!</span>
                    </div>
                </div>
                <div class="scoring-info">
                    <div class="score-item">
                        <span class="score-emoji">‚úÖ</span>
                        <span>Correct = 10 pts</span>
                    </div>
                    <div class="score-item">
                        <span class="score-emoji">‚ö°</span>
                        <span>Speed bonus up to +5 pts</span>
                    </div>
                </div>
            </div>
            
            <button id="start-btn" class="btn primary-btn glow-btn">
                <span class="btn-icon">üéÆ</span>
                <span>Start Game</span>
            </button>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <button id="close-settings" class="close-btn">‚úï</button>
                </div>
                
                <div class="settings-section">
                    <h3>Speech Recognition</h3>
                    <div class="setting-label" style="margin-bottom: 10px;">
                        <span class="setting-emoji">üéôÔ∏è</span>
                        <span>Speech Engine</span>
                    </div>
                    <div class="engine-selector">
                        <button class="engine-btn active" data-engine="vosk">
                            <span class="engine-icon">‚ö°</span>
                            <span class="engine-name">Vosk</span>
                            <span class="engine-desc">Offline ‚Ä¢ Fast</span>
                        </button>
                        <button class="engine-btn" data-engine="webspeech">
                            <span class="engine-icon">‚òÅÔ∏è</span>
                            <span class="engine-name">Web Speech</span>
                            <span class="engine-desc">Online ‚Ä¢ Accurate</span>
                        </button>
                    </div>
                    <input type="hidden" id="speech-engine" value="vosk">
                    <div id="engine-status" class="engine-status">
                        <span class="status-icon">‚è≥</span>
                        <span class="status-text">Vosk model not loaded</span>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Game Timing</h3>
                    <div class="setting-item">
                        <div class="setting-label">
                            <span class="setting-emoji">üß†</span>
                            <span>Think Time</span>
                        </div>
                        <div class="input-wrapper">
                            <button class="input-btn minus" data-target="guess-time">‚àí</button>
                            <input type="number" id="guess-time" value="3" min="3" max="15">
                            <button class="input-btn plus" data-target="guess-time">+</button>
                            <span class="input-unit">sec</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">
                            <span class="setting-emoji">üé§</span>
                            <span>Speak Time</span>
                        </div>
                        <div class="input-wrapper">
                            <button class="input-btn minus" data-target="voice-time">‚àí</button>
                            <input type="number" id="voice-time" value="10" min="3" max="15">
                            <button class="input-btn plus" data-target="voice-time">+</button>
                            <span class="input-unit">sec</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section danger-zone">
                    <h3>Data Management</h3>
                    <button id="clear-data-btn" class="btn danger-btn">
                        <span class="btn-icon">üóëÔ∏è</span>
                        <span>Clear Scores & Cache</span>
                    </button>
                    <p class="hint-text">This will reset all saved scores and settings</p>
                </div>
                
                <button id="save-settings" class="btn primary-btn">
                    <span>Save Settings</span>
                </button>
            </div>
        </div>

        <!-- Countdown Screen -->
        <div id="countdown-screen" class="screen">
            <div class="countdown-container">
                <div id="countdown-number" class="countdown-number">3</div>
                <p class="countdown-text">Get Ready!</p>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="score-display">
                    <span class="score-label">Score</span>
                    <span id="score" class="score-value">0</span>
                </div>
                <div class="question-counter">
                    <span id="current-question">1</span> / <span id="total-questions">10</span>
                </div>
                <div class="timer-display">
                    <span class="timer-label" id="phase-label">Think</span>
                    <span id="timer" class="timer-value">5</span>
                </div>
            </div>

            <div class="emoji-display">
                <div id="emojis" class="emojis"></div>
            </div>

            <div class="phase-indicator">
                <div id="phase-icon" class="phase-icon thinking">üß†</div>
                <p id="phase-text" class="phase-text">Study the emojis...</p>
            </div>

            <div class="voice-section">
                <div id="mic-indicator" class="mic-indicator">
                    <div class="mic-icon">üé§</div>
                    <div class="sound-waves">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                <p id="recognized-text" class="recognized-text"></p>
            </div>

            <div id="feedback" class="feedback"></div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-content">
                <div class="trophy">üèÜ</div>
                <h2>Game Over!</h2>
                
                <div class="final-score">
                    <span class="final-score-label">Your Score</span>
                    <span id="final-score" class="final-score-value">0</span>
                    <span class="final-score-total">/ <span id="max-score">150</span></span>
                </div>
                
                <div class="results-breakdown">
                    <div class="result-stat correct">
                        <span class="stat-icon">‚úÖ</span>
                        <span id="correct-count">0</span>
                        <span class="stat-label">Correct</span>
                    </div>
                    <div class="result-stat incorrect">
                        <span class="stat-icon">‚ùå</span>
                        <span id="incorrect-count">0</span>
                        <span class="stat-label">Incorrect</span>
                    </div>
                    <div class="result-stat timeout">
                        <span class="stat-icon">‚è±Ô∏è</span>
                        <span id="timeout-count">0</span>
                        <span class="stat-label">Timeout</span>
                    </div>
                </div>

                <div class="performance-message" id="performance-message"></div>

                <!-- Previous Scores Section -->
                <div class="previous-scores-section">
                    <h3>üìä Score History</h3>
                    <div id="previous-scores" class="previous-scores-list"></div>
                </div>

                <div class="answers-review">
                    <h3>üìã Review Answers</h3>
                    <div id="answers-list" class="answers-list"></div>
                </div>

                <button id="play-again-btn" class="btn primary-btn">
                    <span class="btn-icon">üè†</span>
                    Play Again
                </button>
            </div>
        </div>
    </div>

    <!-- Vosk Speech Recognition Library -->
    <script src="https://cdn.jsdelivr.net/npm/vosk-browser@0.0.8/dist/vosk.js"></script>
    <script src="game.js"></script>
</body>
</html>
